#!/usr/bin/env rakudo

use lib 'lib';
use lib '.';
use plot;
use util;
use Conf;

sub MAIN($dirs) 
{
    my $conf  = Conf.new;	
    my @disks = parse($dirs);
    my $path = "";    
    my $tmp = "";
    my $addr  = $conf.addr;
    my $level = $conf.nossd_level;
    say $level, $addr;

    for @disks -> $d {
	    say "dir: $d" ;
	    my $f_dir = '/sd' ~ $d ~ '/' ~ 'plots/';
	    $tmp = '/sd' ~ $d ~ '/' ~ 't1/';
            if ($conf.nossd_mining) {
	       $path = $path ~ '-d,r ' ~ $f_dir ~ " ";
	    } else {
	       $path = $path ~ '-d,~t ' ~ $f_dir ~ " ";
	    }
    }
    if ($conf.nossd_mining) {
       say "mining mode";
       say "qqx/tmux new -s mining -d client $path -c $level -a $addr/";
       qqx/tmux new -s mining -d client $path -c $level -a $addr/;
    } else {
       say "ploting mode";
       if (!$conf.notmp) {
            $path = $path ~ '-d,t ' ~ "/sdnv1/t1";
       }
       say $path;
       say "qqx/tmux new -s ploting -d client $path -c $level -a $addr --no-gpu-mining/";
       qqx/tmux new -s ploting -d client $path -c $level -a $addr --no-gpu-mining/;
    }
}
