#!/usr/bin/env rakudo

use lib 'lib';
use lib '.';
use plot;
use util;
use Conf;

sub MAIN($dirs) 
{
    my $conf  = Conf.new;	
    my @disks = parse($dirs);
    my $path = "";    
    my $tmp = "";    
    for @disks -> $d {
	    say "dir: $d" ;
	    my $f_dir = '/sd' ~ $d ~ '/' ~ 'plots/';
	    $tmp = '/sd' ~ $d ~ '/' ~ 't1/';
            if ($conf.nossd_mining) {
	       $path = $path ~ '-d,r ' ~ $f_dir ~ " ";
	    } else {
	       $path = $path ~ '-d,~t ' ~ $f_dir ~ " ";
	    }
    }
    if ($conf.nossd_mining) {
       say "mining mode";
       qqx/tmux new -s mining -d client $path -c $conf.nossd_level -a $conf.addr/;
    } else {
       say "ploting mode";
       if (!$conf.notmp) {
            $path = $path ~ '-d,t ' ~ "/sdnv1/t1";
       }
       say $path;
       qqx/tmux new -s ploting -d client $path -c $conf.nossd_level -a $conf.addr --no-gpu-mining/;
    }
}
